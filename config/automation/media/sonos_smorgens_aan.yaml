  alias: 'sonos smorgens aan'
  initial_state: 'on' 
  trigger:
    platform: state
    entity_id: binary_sensor.pir_keuken
    from: 'off'
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: time
        after: '07:20:00'
        before: '12:00:00'
      - condition: state
        entity_id: binary_sensor.keuken_not_playing
        state: 'on'     # {{ states('media_player.keuken') != 'playing' }}
        for:
          hours: 5
      - condition: or
        conditions:
          - condition: template
            value_template: >
              {% if states.calendar.monnikenheide_monnikenheide.attributes.start_time is defined %}
                {{as_timestamp(states.calendar.monnikenheide_monnikenheide.attributes.start_time) - as_timestamp(now()) | float < 26.640}}
              {% else %}
                False
              {% endif %}    
          - condition: template
            value_template: >
              {% if states.calendar.mondelez_de_vroege.attributes.start_time is defined %}
                {{as_timestamp(states.calendar.mondelez_de_vroege.attributes.start_time) - as_timestamp(now()) | float < 108000}}
              {% else %}
                False
              {% endif %}    
      - condition: or
        conditions:
          # - condition: state
          #   entity_id: input_boolean.gielthuis
          #   state: 'on'
          - condition: state
            entity_id: device_tracker.giel_not_so_binary
            state: 'Thuis'
          - condition: state
            entity_id: device_tracker.martine_not_so_binary
            state: 'Thuis'
          # - condition: state
          #   entity_id: input_boolean.martinethuis
          #   state: 'on'
  action:
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.keuken
        volume_level: 0.12
    - service: media_player.select_source
      data_template:
        entity_id: media_player.keuken
        source: 'Willy'
        # source: 'Arrow Classic Rock'
