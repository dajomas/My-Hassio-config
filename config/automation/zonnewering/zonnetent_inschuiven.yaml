  alias: Zonnetent inschuiven #Sunscreen up/inklappen
  initial_state: 'on' #on reboot HA or reloading of automations, automation is ON
  trigger:

  # Sun based triggers
  - platform: numeric_state
    entity_id: sensor.sun_azimut
    above: 320
    
  # Weather based triggers
  - platform: numeric_state
    entity_id: sensor.windsnelheid
    above: 25 #If wind force becomes to high, sunscreen needs to go up
  - platform: numeric_state
    entity_id: sensor.dark_sky_precip_intensity
    above: 0.25 # Rain at the moment
  - platform: numeric_state
    entity_id: sensor.dark_sky_uv_index
    below: 1
    for:
     minutes: 5 # Sunlight below X for Y minutes

  condition:
    condition: and
    conditions:
      # - condition: template
      #   value_template: '{{as_timestamp(states.automation.zijgevel_openen.attributes.last_triggered) | int <= as_timestamp(states.automation.zijgevel_sluiten.attributes.last_triggered) | int }}' # this automation can only be triggered if timestamp of last_triggered time is OLDER than the timestamp of last_triggered time of the "screen down" automation. This condition prevents that the automation is triggered again if sunscreen is already up. Better would be to have a real sensor checking if sunscreen is up or down but currently I don't have a sensor in place. The | int is used to catch the fact that on start up both triggers report 'none' and hence this condition would never become true. The int makes it such that value = 0 for both and hence trigger can be executed.
      - condition: state
        entity_id: input_boolean.zonnetent_my
        state: 'on'

  action:
    - service: script.zonnetent_openen
    - service: notify.mobile_app_gphone
      data_template:
       message: "De zonnetent is ingeschoven, reden {{trigger.entity_id}} "